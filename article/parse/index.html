<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JSON.parse | megt</title>
    <meta name="description" content="一个NaN导致JSON.parse解析失败的故事">
    <link rel="stylesheet" href="/blog/assets/style.5ebf3245.css">
    <link rel="modulepreload" href="/blog/assets/Home.6c087257.js">
    <link rel="modulepreload" href="/blog/assets/app.b861e993.js">
    <link rel="modulepreload" href="/blog/assets/article_parse_index.md.1df049c0.lean.js">
    <link rel="modulepreload" href="/blog/assets/app.b861e993.js">
    <meta name="twitter:title" content="JSON.parse | megt">
    <meta property="og:title" content="JSON.parse | megt">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/blog/" aria-label="megt, back to home" data-v-675d8756 data-v-4a583abe><!----> megt</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/blog/" data-v-b8818f8c>文章 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/blog/paging/tag/全部/page_1.html" data-v-b8818f8c>标签 <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/YaoXiangMei/blog" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/blog/" data-v-b8818f8c>文章 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/blog/paging/tag/全部/page_1.html" data-v-b8818f8c>标签 <!----></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/YaoXiangMei/blog" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#json-parse">JSON.parse()</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#例子">例子</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#缘由">缘由</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#开始查找问题">开始查找问题</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#_1-使用nodejs的http请求库request请求数据，查看结果返回的数据类型">1. 使用nodejs的http请求库request请求数据，查看结果返回的数据类型</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_2-确认是不是浏览器将字符串转换成json">2. 确认是不是浏览器将字符串转换成json</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div data-v-1c84c82d><h1 id="nan导致json-parse解析失败" tabindex="-1" data-v-1c84c82d>NaN导致JSON.parse解析失败 <a class="header-anchor" href="#nan导致json-parse解析失败" aria-hidden="true" data-v-1c84c82d>#</a></h1><h2 id="json-parse" tabindex="-1" data-v-1c84c82d>JSON.parse() <a class="header-anchor" href="#json-parse" aria-hidden="true" data-v-1c84c82d>#</a></h2><div class="tip custom-block" data-v-1c84c82d><p class="custom-block-title" data-v-1c84c82d>官方定义</p><p data-v-1c84c82d>JSON.parse() 方法用来解析JSON字符串，构造由字符串描述的JavaScript值或对象。提供可选的 reviver 函数用以在返回之前对所得到的对象执行变换(操作)。</p></div><h3 id="例子" tabindex="-1" data-v-1c84c82d>例子 <a class="header-anchor" href="#例子" aria-hidden="true" data-v-1c84c82d>#</a></h3><div class="language-js" data-v-1c84c82d><pre data-v-1c84c82d><code data-v-1c84c82d><span class="token keyword" data-v-1c84c82d>const</span> json <span class="token operator" data-v-1c84c82d>=</span> <span class="token string" data-v-1c84c82d>&#39;{&quot;result&quot;:true, &quot;count&quot;:42}&#39;</span><span class="token punctuation" data-v-1c84c82d>;</span>
<span class="token keyword" data-v-1c84c82d>const</span> obj <span class="token operator" data-v-1c84c82d>=</span> <span class="token constant" data-v-1c84c82d>JSON</span><span class="token punctuation" data-v-1c84c82d>.</span><span class="token function" data-v-1c84c82d>parse</span><span class="token punctuation" data-v-1c84c82d>(</span>json<span class="token punctuation" data-v-1c84c82d>)</span><span class="token punctuation" data-v-1c84c82d>;</span>

console<span class="token punctuation" data-v-1c84c82d>.</span><span class="token function" data-v-1c84c82d>log</span><span class="token punctuation" data-v-1c84c82d>(</span>obj<span class="token punctuation" data-v-1c84c82d>.</span>count<span class="token punctuation" data-v-1c84c82d>)</span><span class="token punctuation" data-v-1c84c82d>;</span>
<span class="token comment" data-v-1c84c82d>// expected output: 42</span>

console<span class="token punctuation" data-v-1c84c82d>.</span><span class="token function" data-v-1c84c82d>log</span><span class="token punctuation" data-v-1c84c82d>(</span>obj<span class="token punctuation" data-v-1c84c82d>.</span>result<span class="token punctuation" data-v-1c84c82d>)</span><span class="token punctuation" data-v-1c84c82d>;</span>
<span class="token comment" data-v-1c84c82d>// expected output: true</span>

</code></pre></div><h2 id="缘由" tabindex="-1" data-v-1c84c82d>缘由 <a class="header-anchor" href="#缘由" aria-hidden="true" data-v-1c84c82d>#</a></h2><strong class="text-sm text-red-500" data-v-1c84c82d> 公司和其它公司合作开发一个项目，我们出前端，B出后端，在对接一个列表接口的时候出现了兼容问题, 返回的数据有时候是string，有时候是object。 我们用的是axios请求接口，我猜测原因可能如下 </strong><ol data-v-1c84c82d><li data-v-1c84c82d>后端数据格式本来就有问题</li><li data-v-1c84c82d>axios转化了数据</li><li data-v-1c84c82d>浏览器转化了数据</li></ol><br data-v-1c84c82d><h2 id="开始查找问题" tabindex="-1" data-v-1c84c82d>开始查找问题 <a class="header-anchor" href="#开始查找问题" aria-hidden="true" data-v-1c84c82d>#</a></h2><h3 id="_1-使用nodejs的http请求库request请求数据，查看结果返回的数据类型" tabindex="-1" data-v-1c84c82d>1. 使用nodejs的http请求库request请求数据，查看结果返回的数据类型 <a class="header-anchor" href="#_1-使用nodejs的http请求库request请求数据，查看结果返回的数据类型" aria-hidden="true" data-v-1c84c82d>#</a></h3><div class="tip custom-block" data-v-1c84c82d><p class="custom-block-title" data-v-1c84c82d>参数说明</p><p data-v-1c84c82d>sample_id为空返回所以列表数据，sample_id有值则返回改样品的列表数据现在有两个样品id为PMD0000000何AD123456</p></div><div class="language-js" data-v-1c84c82d><pre data-v-1c84c82d><code data-v-1c84c82d><span class="token keyword" data-v-1c84c82d>const</span> request <span class="token operator" data-v-1c84c82d>=</span> <span class="token function" data-v-1c84c82d>require</span><span class="token punctuation" data-v-1c84c82d>(</span><span class="token string" data-v-1c84c82d>&#39;request&#39;</span><span class="token punctuation" data-v-1c84c82d>)</span>
<span class="token keyword" data-v-1c84c82d>function</span> <span class="token function" data-v-1c84c82d>getData</span><span class="token punctuation" data-v-1c84c82d>(</span><span class="token punctuation" data-v-1c84c82d>)</span><span class="token punctuation" data-v-1c84c82d>{</span>
    <span class="token keyword" data-v-1c84c82d>return</span> <span class="token keyword" data-v-1c84c82d>new</span> <span class="token class-name" data-v-1c84c82d>Promise</span><span class="token punctuation" data-v-1c84c82d>(</span><span class="token punctuation" data-v-1c84c82d>(</span><span class="token parameter" data-v-1c84c82d>resolve<span class="token punctuation" data-v-1c84c82d>,</span> reject</span><span class="token punctuation" data-v-1c84c82d>)</span><span class="token operator" data-v-1c84c82d>=&gt;</span><span class="token punctuation" data-v-1c84c82d>{</span>
        <span class="token keyword" data-v-1c84c82d>const</span> url <span class="token operator" data-v-1c84c82d>=</span> <span class="token template-string" data-v-1c84c82d><span class="token template-punctuation string" data-v-1c84c82d>`</span><span class="token string" data-v-1c84c82d>http://xxx/sample_table</span><span class="token template-punctuation string" data-v-1c84c82d>`</span></span>
        <span class="token function" data-v-1c84c82d>request</span><span class="token punctuation" data-v-1c84c82d>(</span><span class="token punctuation" data-v-1c84c82d>{</span>
            method<span class="token operator" data-v-1c84c82d>:</span> <span class="token string" data-v-1c84c82d>&#39;post&#39;</span><span class="token punctuation" data-v-1c84c82d>,</span>
            url<span class="token operator" data-v-1c84c82d>:</span> url<span class="token punctuation" data-v-1c84c82d>,</span>
            headers<span class="token operator" data-v-1c84c82d>:</span> <span class="token punctuation" data-v-1c84c82d>{</span>
              Authorization<span class="token operator" data-v-1c84c82d>:</span> <span class="token string" data-v-1c84c82d>&#39;xxx&#39;</span><span class="token punctuation" data-v-1c84c82d>,</span>
            <span class="token punctuation" data-v-1c84c82d>}</span><span class="token punctuation" data-v-1c84c82d>,</span>
            formData<span class="token operator" data-v-1c84c82d>:</span> <span class="token punctuation" data-v-1c84c82d>{</span>
              sample_status<span class="token operator" data-v-1c84c82d>:</span> <span class="token string" data-v-1c84c82d>&#39;&#39;</span><span class="token punctuation" data-v-1c84c82d>,</span>
              start_date<span class="token operator" data-v-1c84c82d>:</span> <span class="token string" data-v-1c84c82d>&#39;&#39;</span><span class="token punctuation" data-v-1c84c82d>,</span>
              end_date<span class="token operator" data-v-1c84c82d>:</span> <span class="token string" data-v-1c84c82d>&#39;&#39;</span><span class="token punctuation" data-v-1c84c82d>,</span>
              sample_id<span class="token operator" data-v-1c84c82d>:</span> <span class="token string" data-v-1c84c82d>&#39;&#39;</span> <span class="token comment" data-v-1c84c82d>// 样品id</span>
            <span class="token punctuation" data-v-1c84c82d>}</span><span class="token punctuation" data-v-1c84c82d>,</span>
        <span class="token punctuation" data-v-1c84c82d>}</span><span class="token punctuation" data-v-1c84c82d>,</span> <span class="token punctuation" data-v-1c84c82d>(</span><span class="token parameter" data-v-1c84c82d>err<span class="token punctuation" data-v-1c84c82d>,</span> response<span class="token punctuation" data-v-1c84c82d>,</span> body</span><span class="token punctuation" data-v-1c84c82d>)</span><span class="token operator" data-v-1c84c82d>=&gt;</span><span class="token punctuation" data-v-1c84c82d>{</span>
          <span class="token comment" data-v-1c84c82d>// 无论是sample_id等于PMD0000000，还是等于AD123456，输出结果都是string</span>
          console<span class="token punctuation" data-v-1c84c82d>.</span><span class="token function" data-v-1c84c82d>log</span><span class="token punctuation" data-v-1c84c82d>(</span><span class="token keyword" data-v-1c84c82d>typeof</span> response<span class="token punctuation" data-v-1c84c82d>.</span>body<span class="token punctuation" data-v-1c84c82d>)</span>
          console<span class="token punctuation" data-v-1c84c82d>.</span><span class="token function" data-v-1c84c82d>log</span><span class="token punctuation" data-v-1c84c82d>(</span>response<span class="token punctuation" data-v-1c84c82d>.</span>body<span class="token punctuation" data-v-1c84c82d>)</span>
        <span class="token punctuation" data-v-1c84c82d>}</span><span class="token punctuation" data-v-1c84c82d>)</span>
    <span class="token punctuation" data-v-1c84c82d>}</span><span class="token punctuation" data-v-1c84c82d>)</span>
<span class="token punctuation" data-v-1c84c82d>}</span>

sample_id <span class="token operator" data-v-1c84c82d>=</span> <span class="token constant" data-v-1c84c82d>PMD0000000</span>结果
<span class="token template-string" data-v-1c84c82d><span class="token template-punctuation string" data-v-1c84c82d>`</span><span class="token string" data-v-1c84c82d>{
	&quot;feedback&quot;: {
		&quot;table&quot;: [{
			&quot;age&quot;: 22,
			&quot;cg_date&quot;: &quot;Mon, 27 Sep 2021 10:38:14 GMT&quot;,
			&quot;finance_check&quot;: &quot;已通过&quot;,
			&quot;name&quot;: &quot;test222&quot;,
			&quot;salesman&quot;: &quot;测试者&quot;,
			&quot;sample_date&quot;: &quot;Thu, 02 Sep 2021 00:00:00 GMT&quot;,
			&quot;sample_id&quot;: &quot;PMD0000000&quot;,
			&quot;sex&quot;: &quot;女&quot;,
			&quot;sp_st&quot;: &quot;待接收&quot;
		}],
		&quot;total&quot;: 1
	},
	&quot;return&quot;: &quot;successes&quot;
}</span><span class="token template-punctuation string" data-v-1c84c82d>`</span></span>

sample_id <span class="token operator" data-v-1c84c82d>=</span> <span class="token constant" data-v-1c84c82d>AD123456</span>结果
<span class="token template-string" data-v-1c84c82d><span class="token template-punctuation string" data-v-1c84c82d>`</span><span class="token string" data-v-1c84c82d>{
  &quot;feedback&quot;: {
    &quot;table&quot;: [
      {
        &quot;age&quot;: NaN, 
        &quot;cg_date&quot;: &quot;Thu, 02 Sep 2021 09:21:50 GMT&quot;, 
        &quot;finance_check&quot;: &quot;待复审&quot;, 
        &quot;name&quot;: NaN, 
        &quot;salesman&quot;: &quot;测试者&quot;, 
        &quot;sample_date&quot;: &quot;Thu, 02 Sep 2021 00:00:00 GMT&quot;, 
        &quot;sample_id&quot;: &quot;AD12345&quot;, 
        &quot;sex&quot;: NaN, 
        &quot;sp_st&quot;: &quot;&quot;
      }
    ], 
    &quot;total&quot;: 1
  }, 
  &quot;return&quot;: &quot;successes&quot;
}</span><span class="token template-punctuation string" data-v-1c84c82d>`</span></span>

</code></pre></div><p data-v-1c84c82d>根据结果可以看到response.body永远都是string，这说明是axios或者是浏览器把string转换了json数据</p><h3 id="_2-确认是不是浏览器将字符串转换成json" tabindex="-1" data-v-1c84c82d>2. 确认是不是浏览器将字符串转换成json <a class="header-anchor" href="#_2-确认是不是浏览器将字符串转换成json" aria-hidden="true" data-v-1c84c82d>#</a></h3><ul data-v-1c84c82d><li data-v-1c84c82d> 打开浏览器开发者工具 </li><li data-v-1c84c82d> 打开network，选中接口，点击Initiator查看axios是否进行了转化数据（或者直接去看源码），发现并没有相关的代码 </li><li data-v-1c84c82d> 点击Prview面板，结果发现sample_id = PMD0000000接口返回的数据可以折叠，sample_id = AD12345接口返回的数据却无法折叠 </li></ul><strong class="text-sm text-red-500" data-v-1c84c82d> 以上操作足以说明是浏览器转化了数据，但是为什么有的转化有的不转化呢？，带着疑问仔细观察了AD123456返回的数据，有几个字段的值是NaN，所以有可能是NaN导致解析失败 </strong><div class="language-js" data-v-1c84c82d><pre data-v-1c84c82d><code data-v-1c84c82d><span class="token keyword" data-v-1c84c82d>const</span> person <span class="token operator" data-v-1c84c82d>=</span> <span class="token template-string" data-v-1c84c82d><span class="token template-punctuation string" data-v-1c84c82d>`</span><span class="token string" data-v-1c84c82d>{&quot;name&quot;:NaN}</span><span class="token template-punctuation string" data-v-1c84c82d>`</span></span>
<span class="token constant" data-v-1c84c82d>JSON</span><span class="token punctuation" data-v-1c84c82d>.</span><span class="token function" data-v-1c84c82d>parse</span><span class="token punctuation" data-v-1c84c82d>(</span>person<span class="token punctuation" data-v-1c84c82d>)</span>
<span class="token comment" data-v-1c84c82d>// 抛错如下</span>
Uncaught SyntaxError<span class="token operator" data-v-1c84c82d>:</span> Unexpected token <span class="token constant" data-v-1c84c82d>N</span> <span class="token keyword" data-v-1c84c82d>in</span> <span class="token constant" data-v-1c84c82d>JSON</span> at position <span class="token number" data-v-1c84c82d>8</span>
这说明它建<span class="token number" data-v-1c84c82d>NaN</span>当字符串处理了

</code></pre></div><div class="language-js" data-v-1c84c82d><pre data-v-1c84c82d><code data-v-1c84c82d><span class="token keyword" data-v-1c84c82d>const</span> person <span class="token operator" data-v-1c84c82d>=</span> <span class="token template-string" data-v-1c84c82d><span class="token template-punctuation string" data-v-1c84c82d>`</span><span class="token string" data-v-1c84c82d>{&quot;name&quot;:&quot;NaN&quot;}</span><span class="token template-punctuation string" data-v-1c84c82d>`</span></span>
<span class="token constant" data-v-1c84c82d>JSON</span><span class="token punctuation" data-v-1c84c82d>.</span><span class="token function" data-v-1c84c82d>parse</span><span class="token punctuation" data-v-1c84c82d>(</span>person<span class="token punctuation" data-v-1c84c82d>)</span> <span class="token comment" data-v-1c84c82d>// 解析成功</span>

</code></pre></div><p data-v-1c84c82d> 问题根源已经找到，就是根源已经定位成功，NaN导致JSON.parse解析失败，最后解决方法是让后端处理下NaN数据 </p><div id="gitalk-container" data-v-1c84c82d></div></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--><!-- <Copyright /> --><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"article_blog_index.md\":\"7f21a69d\",\"article_fiddler_index.md\":\"64c7dddd\",\"article_parse_index.md\":\"1df049c0\",\"article_performace_index.md\":\"7af7e615\",\"index.md\":\"eb67920b\",\"paging_article_page_1.md\":\"036d2ac5\",\"paging_article_page_2.md\":\"423068f3\",\"paging_tag_json.parse_page_1.md\":\"88d9d8c6\",\"paging_tag_bug_page_1.md\":\"0478c255\",\"paging_tag_fiddler_page_1.md\":\"b0248f1c\",\"paging_tag_vite_page_1.md\":\"e2f30743\",\"paging_tag_vitepress_page_1.md\":\"c523fde8\",\"paging_tag_代理_page_1.md\":\"2c2038a0\",\"paging_tag_优化_page_1.md\":\"ba9c68cd\",\"paging_tag_全部_page_1.md\":\"9bf41498\",\"paging_tag_全部_page_2.md\":\"464d5c44\",\"paging_tag_性能_page_1.md\":\"7c80e9f4\",\"paging_tag_抓包_page_1.md\":\"76d9d934\"}")</script>
    <script type="module" async src="/blog/assets/app.b861e993.js"></script>
    
  </body>
</html>